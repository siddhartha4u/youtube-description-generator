<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>YouTube Description Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0d1117; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const apiKey = "AIzaSyC3m6k8ONG67lMr3YMEGT4svIWaYxig-BY";

        let title = "";
        let thumbnail = null; // Store file object instead of name
        let primaryKeyword = "";
        let secondaryKeywords = ["", "", "", "", ""];
        let descriptions = [];
        let loading = false;
        let error = "";

        const copyToClipboard = text => {
            const temp = document.createElement("textarea");
            temp.value = text;
            document.body.appendChild(temp);
            temp.select();
            document.execCommand("copy");
            document.body.removeChild(temp);
        };

        const spinner = () => `
            <svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
            </svg>`;
            
        const render = () => {
            const app = document.getElementById("app");
            const canGenerate = (title.trim() || thumbnail) && primaryKeyword.trim() && !loading;

            app.innerHTML = `
                <div class="min-h-screen bg-gray-900 text-white p-4 sm:p-8 flex justify-center">
                    <div class="bg-gray-800 p-6 sm:p-10 rounded-xl shadow-2xl w-full max-w-4xl">
                        <h1 class="text-3xl sm:text-4xl font-extrabold text-center mb-6 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600">
                            YouTube Description Generator ✍️
                        </h1>
                        <p class="text-center text-gray-400 mb-6">Fill in the details below to generate SEO-friendly video descriptions</p>

                        <!-- YouTube Title -->
                        <div class="mb-4">
                            <label class="block mb-2 text-gray-300 font-bold">YouTube Video Title</label>
                            <input id="title" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none" value="${title}" placeholder="e.g. Best AI Tools for Students in 2025" />
                            <p class="text-gray-500 text-sm mt-1">Or, attach a thumbnail below.</p>
                        </div>

                        <!-- Thumbnail (Optional) -->
                        <div class="mb-4">
                            <label class="block mb-2 text-gray-300 font-bold">Attach Thumbnail</label>
                            <input type="file" id="thumbnail" accept="image/png, image/jpeg" class="text-white bg-gray-700 file:bg-gray-600 file:text-white file:rounded-lg file:px-4 file:py-2"/>
                            <p class="text-gray-500 text-sm mt-1">Only PNG, JPG format acceptable. Size below 1MB.</p>
                        </div>

                        <!-- Primary Keyword -->
                        <div class="mb-4">
                            <label class="block mb-2 text-gray-300 font-bold">Primary Keyword</label>
                            <input id="primaryKeyword" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600" value="${primaryKeyword}" placeholder="Required keyword e.g. AI tools" />
                        </div>

                        <!-- Secondary Keywords -->
                        <div class="mb-6">
                            <label class="block mb-2 text-gray-300 font-bold">Secondary Keywords (Optional - Max 5)</label>
                            ${secondaryKeywords.map((kw, i) => `
                                <input class="w-full mb-2 p-2 rounded-lg bg-gray-700 text-white border border-gray-600 secondary-keyword" data-index="${i}" value="${kw}" placeholder="Secondary Keyword ${i + 1}" />
                            `).join('')}
                        </div>

                        <!-- Generate Button -->
                        <button id="generateBtn" ${!canGenerate && "disabled"}
                            class="w-full p-4 rounded-lg font-bold text-white transition-all
                            ${canGenerate
                                ? 'bg-gradient-to-r from-green-500 to-blue-600 hover:from-green-600 hover:to-blue-700 transform hover:scale-105'
                                : 'bg-gray-600 cursor-not-allowed'}">
                            ${loading ? spinner() : "Generate Descriptions"}
                        </button>

                        ${error ? `<p class="text-red-400 text-center mt-4">${error}</p>` : ""}

                        <!-- Output Descriptions -->
                        ${descriptions.length > 0
                            ? `<div class="mt-8">
                                <h2 class="text-2xl text-center text-gray-200 mb-4 font-bold">Generated Descriptions</h2>
                                <div class="space-y-4">
                                    ${descriptions.map(desc => `
                                        <div class="bg-gray-700 p-4 rounded-lg">
                                            <p class="text-white mb-2 whitespace-pre-line">${desc}</p>
                                            <button class="copy-btn bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded" data-text="${desc.replace(/"/g, '&quot;')}">
                                                Copy Description
                                            </button>
                                        </div>`).join('')}
                                </div>
                            </div>`
                            : ""}
                    </div>
                </div>`;
            
            // Add listeners after rendering
            document.getElementById("title").oninput = e => {
                title = e.target.value;
                if(title.trim()){
                    thumbnail = null; // Clear thumbnail data
                }
                render();
            };
            document.getElementById("primaryKeyword").oninput = e => {
                primaryKeyword = e.target.value;
                render();
            };
            document.querySelectorAll(".secondary-keyword").forEach(input => {
                input.oninput = e => {
                    secondaryKeywords[parseInt(e.target.dataset.index)] = e.target.value;
                    render();
                };
            });
            document.getElementById("generateBtn").onclick = generateDescriptions;
            document.querySelectorAll(".copy-btn").forEach(btn => {
                btn.onclick = () => copyToClipboard(btn.dataset.text);
            });
        };

        const generateDescriptions = async () => {
            if (!primaryKeyword.trim()) {
                error = "Primary keyword is required.";
                render(); return;
            }
            if (!title.trim() && !thumbnail) {
                error = "Please enter a title or attach a thumbnail.";
                render(); return;
            }
            if(!apiKey || apiKey === "PASTE_YOUR_API_KEY_HERE"){
                error = "API Key is missing. Please add your key to the code to proceed.";
                render(); return;
            }
            
            loading = true;
            error = "";
            descriptions = [];
            render();

            const filteredSecondaries = secondaryKeywords.filter(k => k.trim());
            let parts = [];
            
            // Build prompt based on title or thumbnail
            if (title.trim()) {
                parts.push({
                    text: `Generate a JSON array of 5 YouTube video descriptions for a video titled "${title}".`
                });
            } else if (thumbnail) {
                const base64ImageData = await new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result.split(',')[1]);
                    reader.readAsDataURL(thumbnail);
                });
                
                parts.push({
                    text: `Generate a JSON array of 5 YouTube video descriptions for the attached thumbnail. Describe what the video is about based on the image.`
                });
                parts.push({
                    inlineData: {
                        mimeType: thumbnail.type,
                        data: base64ImageData
                    }
                });
            }

            // Add the rest of the prompt details
            parts.push({
                text: `Each description should:
                - Be between 100 to 120 words (about 600–720 characters).
                - Start with an attention-grabbing hook.
                - Include the exact primary keyword: "${primaryKeyword}".
                - Include as many of the following secondary keywords as naturally possible: ${filteredSecondaries.join(", ") || "None"}.
                - Explain what the video offers in 2 sentences.
                - Contain 1 strong call-to-action.
                - End with 2-3 trending and relevant hashtags.`
            });

            const payload = {
                contents: [{ role: "user", parts }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: { type: "ARRAY", items: { type: "STRING" } }
                }
            };
            const modelName = thumbnail ? "gemini-2.5-flash-preview-05-20" : "gemini-2.5-flash-preview-05-20";

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                const json = await res.json();
                const content = json?.candidates?.[0]?.content?.parts?.[0]?.text;
                const parsed = JSON.parse(content);
                descriptions = Array.isArray(parsed) ? parsed : [];
            } catch (e) {
                console.error(e);
                error = "Something went wrong. Try again later.";
            }

            loading = false;
            render();
        };

        const thumbInput = document.getElementById("thumbnail");
        thumbInput && (thumbInput.onchange = e => {
            const file = e.target.files[0];
            if(file){
                const validTypes = ['image/png', 'image/jpeg'];
                const maxSize = 1048576; // 1 MB in bytes

                if (!validTypes.includes(file.type)) {
                    error = "Invalid file type. Please upload a JPG or PNG image.";
                    thumbnail = null;
                    e.target.value = ''; // Clear the file input
                } else if (file.size > maxSize) {
                    error = "File size exceeds 1MB. Please upload a smaller image.";
                    thumbnail = null;
                    e.target.value = ''; // Clear the file input
                } else {
                    error = ""; // Clear any previous errors
                    thumbnail = file;
                }
            } else {
                thumbnail = null;
                error = ""; // Clear error if file input is cleared
            }
            render();
        });

        render();
    </script>
</body>
</html>
